{
  "version": "1.0.0",
  "last_updated": "2025-12-09T00:00:00Z",
  "description": "Defines task patterns and conditions that REQUIRE union-certified workers",

  "hard_requirements": {
    "description": "Conditions that ALWAYS require union workers (cannot be overridden)",

    "environment_based": {
      "production": {
        "level_required": 2,
        "reason": "All production operations require certified workers",
        "exceptions": []
      },
      "production_critical": {
        "level_required": 3,
        "reason": "Critical production systems require advanced certification",
        "exceptions": []
      },
      "multi_region_production": {
        "level_required": 4,
        "reason": "Multi-region deployments require master certification",
        "exceptions": []
      }
    },

    "data_sensitivity": {
      "pii": {
        "level_required": 3,
        "reason": "Personal Identifiable Information requires advanced certification",
        "data_types": ["email", "phone", "address", "ssn", "name", "dob"],
        "regulations": ["GDPR", "CCPA", "PIPEDA"]
      },
      "phi": {
        "level_required": 3,
        "reason": "Protected Health Information requires advanced certification",
        "data_types": ["medical_records", "health_data", "diagnoses", "treatments"],
        "regulations": ["HIPAA", "HITECH"]
      },
      "financial": {
        "level_required": 3,
        "reason": "Financial data requires advanced certification",
        "data_types": ["credit_card", "bank_account", "payment_info", "transactions"],
        "regulations": ["PCI-DSS", "SOX"]
      },
      "credentials": {
        "level_required": 3,
        "reason": "Credentials and secrets require advanced certification",
        "data_types": ["passwords", "api_keys", "tokens", "certificates"],
        "regulations": ["SOC 2", "ISO 27001"]
      }
    },

    "operation_type": {
      "database_migration": {
        "level_required": 3,
        "reason": "Schema changes are high-risk and irreversible",
        "patterns": ["ALTER TABLE", "DROP", "TRUNCATE", "migration", "schema_change"]
      },
      "infrastructure_change": {
        "level_required": 3,
        "reason": "Infrastructure modifications affect system stability",
        "patterns": ["terraform", "cloudformation", "kubernetes", "cluster", "network"]
      },
      "security_operation": {
        "level_required": 3,
        "reason": "Security changes require specialized expertise",
        "patterns": ["firewall", "iam", "rbac", "encryption", "certificates", "auth"]
      },
      "data_deletion": {
        "level_required": 3,
        "reason": "Irreversible data operations require certification",
        "patterns": ["DELETE", "DROP", "TRUNCATE", "purge", "remove"]
      }
    },

    "impact_scope": {
      "customer_facing": {
        "level_required": 2,
        "reason": "Customer-facing changes require certification",
        "services": ["web", "api", "mobile", "email", "notifications"]
      },
      "system_wide": {
        "level_required": 3,
        "reason": "System-wide changes affect entire platform",
        "components": ["load_balancer", "cdn", "cache", "message_queue", "database"]
      },
      "multi_service": {
        "level_required": 3,
        "reason": "Coordinated changes across services are complex",
        "min_services": 3
      }
    }
  },

  "production_indicators": {
    "description": "Patterns that indicate production environment",

    "environment_variables": [
      "NODE_ENV=production",
      "RAILS_ENV=production",
      "ENV=prod",
      "ENVIRONMENT=production",
      "DEPLOY_ENV=production"
    ],

    "hostname_patterns": [
      "*.prod.*",
      "*.production.*",
      "*-prod-*",
      "*.live.*",
      "*.prd.*"
    ],

    "domain_patterns": [
      "*.com",
      "*.io",
      "*.net",
      "api.*",
      "www.*"
    ],

    "infrastructure_markers": {
      "kubernetes_namespace": ["production", "prod", "default"],
      "aws_tags": ["Environment:production", "Env:prod"],
      "branch_names": ["main", "master", "production", "release/*"]
    },

    "task_flags": {
      "critical": true,
      "production": true,
      "customer_facing": true,
      "high_risk": true,
      "irreversible": true
    }
  },

  "audit_requirements": {
    "description": "Audit and logging requirements for union workers",

    "level_2": {
      "required_logs": [
        "operation_type",
        "timestamp",
        "worker_id",
        "input_parameters",
        "output_results",
        "execution_time",
        "error_conditions",
        "approver_id",
        "approval_timestamp"
      ],
      "retention_days": 90,
      "real_time_monitoring": true,
      "alerting_required": true,
      "log_destinations": ["audit_log", "metrics", "dashboard"]
    },

    "level_3": {
      "required_logs": [
        "operation_type",
        "timestamp",
        "worker_id",
        "certification_level",
        "input_parameters",
        "output_results",
        "data_accessed",
        "data_modified",
        "execution_time",
        "error_conditions",
        "rollback_capability",
        "approver_id",
        "approval_timestamp",
        "security_context",
        "compliance_tags"
      ],
      "retention_days": 365,
      "real_time_monitoring": true,
      "alerting_required": true,
      "security_monitoring": true,
      "compliance_reporting": true,
      "log_destinations": ["audit_log", "security_log", "compliance_log", "metrics", "dashboard"]
    },

    "level_4": {
      "required_logs": [
        "operation_type",
        "timestamp",
        "worker_id",
        "certification_level",
        "input_parameters",
        "output_results",
        "data_accessed",
        "data_modified",
        "systems_affected",
        "execution_time",
        "error_conditions",
        "rollback_capability",
        "rollback_tested",
        "approver_id",
        "approval_timestamp",
        "security_context",
        "compliance_tags",
        "change_justification",
        "risk_assessment",
        "impact_analysis"
      ],
      "retention_days": 2555,
      "real_time_monitoring": true,
      "alerting_required": true,
      "security_monitoring": true,
      "compliance_reporting": true,
      "executive_visibility": true,
      "external_audit_ready": true,
      "log_destinations": ["audit_log", "security_log", "compliance_log", "executive_dashboard", "metrics", "dashboard"]
    }
  },

  "approval_gates": {
    "description": "Required approvals for each certification level",

    "level_2_standard": {
      "approvers_required": 1,
      "approver_roles": ["engineering_manager", "tech_lead", "senior_engineer"],
      "max_approval_time_hours": 24,
      "requires": {
        "test_results": true,
        "code_review": true,
        "documentation": true,
        "rollback_plan": true
      },
      "can_auto_approve": false
    },

    "level_3_advanced": {
      "approvers_required": 2,
      "approver_roles": ["engineering_director", "security_lead", "architecture_lead"],
      "max_approval_time_hours": 48,
      "requires": {
        "test_results": true,
        "code_review": true,
        "security_review": true,
        "documentation": true,
        "rollback_plan": true,
        "rollback_tested": true,
        "impact_analysis": true,
        "stakeholder_notification": true
      },
      "can_auto_approve": false,
      "requires_synchronous_review": true
    },

    "level_4_master": {
      "approvers_required": 3,
      "approver_roles": ["vp_engineering", "cto", "ciso", "coo"],
      "max_approval_time_hours": 168,
      "requires": {
        "test_results": true,
        "code_review": true,
        "security_review": true,
        "architecture_review": true,
        "documentation": true,
        "rollback_plan": true,
        "rollback_tested": true,
        "rollback_rehearsed": true,
        "impact_analysis": true,
        "risk_assessment": true,
        "stakeholder_notification": true,
        "customer_communication_plan": true,
        "incident_response_plan": true,
        "business_justification": true
      },
      "can_auto_approve": false,
      "requires_synchronous_review": true,
      "requires_change_advisory_board": true
    },

    "emergency_override": {
      "description": "Emergency procedures for critical incidents",
      "approvers_required": 1,
      "approver_roles": ["incident_commander", "on_call_lead"],
      "max_approval_time_minutes": 15,
      "temporary_certification_duration_hours": 1,
      "requires": {
        "incident_ticket": true,
        "real_time_oversight": true,
        "post_incident_review": true
      },
      "triggers": [
        "production_outage",
        "security_breach",
        "data_loss_event",
        "customer_impact_severity_1"
      ],
      "automatic_revocation": true,
      "enhanced_monitoring": true
    }
  },

  "certification_requirements": {
    "description": "Requirements to obtain union certification",

    "level_2_certification": {
      "prerequisites": [
        "Complete development worker training",
        "30 days experience with non-union workers",
        "No incidents in past 30 days"
      ],
      "testing": {
        "test_coverage_minimum": 0.90,
        "integration_tests_required": true,
        "performance_benchmarks_required": true,
        "failure_mode_testing_required": true
      },
      "documentation": {
        "operational_runbook": true,
        "incident_response_procedures": true,
        "rollback_documentation": true
      },
      "review_process": {
        "code_review_required": true,
        "security_scan_required": true,
        "dependency_audit_required": true
      },
      "probation_period_days": 30,
      "recertification_frequency_days": 365
    },

    "level_3_certification": {
      "prerequisites": [
        "Level 2 certification for 90+ days",
        "10+ successful Level 2 operations",
        "No incidents in past 90 days",
        "Senior engineer recommendation"
      ],
      "testing": {
        "test_coverage_minimum": 0.95,
        "integration_tests_required": true,
        "performance_benchmarks_required": true,
        "failure_mode_testing_required": true,
        "chaos_testing_required": true,
        "security_testing_required": true
      },
      "documentation": {
        "operational_runbook": true,
        "incident_response_procedures": true,
        "rollback_documentation": true,
        "disaster_recovery_plan": true,
        "security_documentation": true,
        "compliance_mapping": true
      },
      "review_process": {
        "code_review_required": true,
        "security_audit_required": true,
        "architecture_review_required": true,
        "dependency_audit_required": true,
        "penetration_testing": true
      },
      "probation_period_days": 60,
      "recertification_frequency_days": 90
    },

    "level_4_certification": {
      "prerequisites": [
        "Level 3 certification for 180+ days",
        "25+ successful Level 3 operations",
        "No incidents in past 180 days",
        "Director-level recommendation",
        "Demonstrated architectural expertise"
      ],
      "testing": {
        "test_coverage_minimum": 0.98,
        "integration_tests_required": true,
        "performance_benchmarks_required": true,
        "failure_mode_testing_required": true,
        "chaos_testing_required": true,
        "security_testing_required": true,
        "multi_region_testing_required": true,
        "disaster_recovery_testing_required": true
      },
      "documentation": {
        "operational_runbook": true,
        "incident_response_procedures": true,
        "rollback_documentation": true,
        "disaster_recovery_plan": true,
        "security_documentation": true,
        "compliance_mapping": true,
        "architecture_documentation": true,
        "training_materials": true
      },
      "review_process": {
        "code_review_required": true,
        "security_audit_required": true,
        "architecture_review_required": true,
        "dependency_audit_required": true,
        "penetration_testing": true,
        "external_audit": true,
        "certification_board_presentation": true
      },
      "probation_period_days": 90,
      "recertification_frequency_days": 90,
      "continuous_monitoring": true
    }
  },

  "safety_boundaries": {
    "description": "Hard limits that cannot be bypassed",

    "environment_isolation": {
      "rule": "Non-union workers cannot access production",
      "enforcement": "hard_block",
      "override_allowed": false
    },

    "data_protection": {
      "rule": "PII/PHI/Financial data requires Level 3+",
      "enforcement": "hard_block",
      "override_allowed": false
    },

    "cross_promotion": {
      "rule": "Cannot auto-promote workers across certification levels",
      "enforcement": "hard_block",
      "override_allowed": false
    },

    "approval_bypass": {
      "rule": "Required approvals cannot be skipped except emergency override",
      "enforcement": "hard_block",
      "override_allowed": true,
      "override_conditions": ["emergency_override"]
    },

    "audit_trail": {
      "rule": "All Level 2+ operations must be fully logged",
      "enforcement": "hard_block",
      "override_allowed": false
    }
  },

  "risk_matrix": {
    "description": "Risk assessment framework for certification requirements",

    "risk_factors": {
      "environment": {
        "production": 10,
        "staging": 5,
        "development": 1,
        "local": 0
      },
      "reversibility": {
        "irreversible": 10,
        "complex_rollback": 7,
        "automated_rollback": 3,
        "fully_reversible": 0
      },
      "data_sensitivity": {
        "pii_phi_financial": 10,
        "internal_confidential": 7,
        "internal": 3,
        "public": 0
      },
      "impact_scope": {
        "multi_region": 10,
        "system_wide": 8,
        "multi_service": 6,
        "single_service": 3,
        "single_component": 1
      },
      "customer_impact": {
        "all_customers": 10,
        "customer_segment": 7,
        "internal_users": 3,
        "no_users": 0
      }
    },

    "certification_thresholds": {
      "level_0_non_union": {
        "max_risk_score": 5,
        "description": "Very low risk, development only"
      },
      "level_2_standard": {
        "min_risk_score": 6,
        "max_risk_score": 20,
        "description": "Low to medium risk, standard production"
      },
      "level_3_advanced": {
        "min_risk_score": 21,
        "max_risk_score": 35,
        "description": "Medium to high risk, critical systems"
      },
      "level_4_master": {
        "min_risk_score": 36,
        "description": "Very high risk, system-wide changes"
      }
    }
  },

  "compliance_mappings": {
    "SOC2": {
      "minimum_certification_level": 2,
      "required_controls": [
        "access_logging",
        "change_management",
        "approval_workflows",
        "audit_trails"
      ]
    },
    "HIPAA": {
      "minimum_certification_level": 3,
      "required_controls": [
        "access_logging",
        "encryption",
        "audit_trails",
        "incident_response",
        "phi_protection"
      ]
    },
    "PCI_DSS": {
      "minimum_certification_level": 3,
      "required_controls": [
        "access_logging",
        "encryption",
        "network_segmentation",
        "audit_trails",
        "change_management"
      ]
    },
    "GDPR": {
      "minimum_certification_level": 3,
      "required_controls": [
        "data_protection",
        "access_logging",
        "audit_trails",
        "data_deletion",
        "consent_management"
      ]
    },
    "SOX": {
      "minimum_certification_level": 4,
      "required_controls": [
        "change_management",
        "segregation_of_duties",
        "audit_trails",
        "approval_workflows",
        "financial_controls"
      ]
    }
  }
}
