{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "task-queue-entry.schema.json",
  "title": "Task Queue Entry",
  "description": "Schema for a task entry in the task queue",
  "type": "object",
  "required": ["id", "title", "type", "priority", "status", "created_at"],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^(task-[0-9]+|test-task-[0-9]+)$",
      "description": "Unique task identifier"
    },
    "title": {
      "type": "string",
      "minLength": 5,
      "maxLength": 200,
      "description": "Human-readable task title"
    },
    "type": {
      "type": "string",
      "enum": ["feature", "bug", "security_scan", "security-scan", "refactor", "optimization", "documentation", "development", "infrastructure"],
      "description": "Task type classification"
    },
    "priority": {
      "type": "string",
      "enum": ["critical", "high", "medium", "low"],
      "description": "Task priority level"
    },
    "status": {
      "type": "string",
      "enum": ["pending", "assigned", "in_progress", "worker_spawned", "blocked", "completed", "failed", "cancelled"],
      "description": "Current task status"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of task creation"
    },
    "created_by": {
      "type": "string",
      "description": "Entity that created the task"
    },
    "assigned_to": {
      "type": "string",
      "enum": ["development", "development-master", "security", "security-master", "inventory", "inventory-master", "cicd", "cicd-master", "coordinator"],
      "description": "Master agent assigned to the task"
    },
    "assigned_by": {
      "type": "string",
      "description": "Entity that assigned the task"
    },
    "assigned_at": {
      "type": "string",
      "description": "Timestamp when task was assigned"
    },
    "started_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when work started"
    },
    "completed_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when task completed"
    },
    "updated_at": {
      "type": "string",
      "description": "Timestamp of last update"
    },
    "context": {
      "type": "object",
      "required": ["description"],
      "properties": {
        "description": {
          "type": "string",
          "minLength": 10,
          "description": "Detailed task description"
        },
        "repository": {
          "type": "string",
          "description": "Target repository"
        },
        "branch": {
          "type": "string",
          "description": "Target branch"
        },
        "requirements": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of requirements"
        },
        "acceptance_criteria": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Acceptance criteria"
        },
        "scan_types": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["dependencies", "static-analysis", "secrets", "sast", "dast"]
          },
          "description": "Security scan types"
        }
      },
      "additionalProperties": true
    },
    "routing_confidence": {
      "type": "string",
      "pattern": "^0\\.[0-9]{2}$|^1\\.00$",
      "description": "MoE routing confidence score (0.00-1.00)"
    },
    "routing_strategy": {
      "type": "string",
      "enum": ["single_expert", "single_expert_low_confidence", "ensemble", "sparse_pool", "full_pool"],
      "description": "MoE routing strategy applied"
    },
    "worker_id": {
      "type": "string",
      "pattern": "^(dev|sec|inv|cicd)-worker-[A-F0-9]{8}$",
      "description": "Assigned worker ID"
    },
    "worker_type": {
      "type": "string",
      "description": "Type of worker assigned"
    },
    "error": {
      "type": "string",
      "description": "Error message if task failed"
    },
    "result": {
      "type": "object",
      "description": "Task result data"
    },
    "review": {
      "type": "object",
      "description": "Quality review loop configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Whether review loops are enabled for this task"
        },
        "min_cycles": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "default": 1,
          "description": "Minimum number of review cycles required"
        },
        "max_cycles": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 3,
          "description": "Maximum number of review cycles allowed"
        },
        "auto_approve_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.95,
          "description": "Confidence threshold for automatic approval"
        },
        "confidence_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.85,
          "description": "Minimum confidence for approval"
        },
        "review_type": {
          "type": "string",
          "enum": ["code", "security", "documentation", "architecture", "test"],
          "description": "Type of review to perform"
        },
        "history": {
          "type": "array",
          "description": "Review cycle history",
          "items": {
            "type": "object",
            "properties": {
              "cycle": {
                "type": "integer",
                "minimum": 1
              },
              "timestamp": {
                "type": "string",
                "format": "date-time"
              },
              "confidence": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "approved": {
                "type": "boolean"
              },
              "feedback": {
                "type": "string"
              },
              "suggestions": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  }
}
