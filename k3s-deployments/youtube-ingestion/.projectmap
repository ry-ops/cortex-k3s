YouTube Ingestion Service - Project Map
=======================================

youtube-ingestion/
â”‚
â”œâ”€â”€ ğŸ“„ Core Documentation
â”‚   â”œâ”€â”€ README.md                         # Main documentation, API reference, usage
â”‚   â”œâ”€â”€ PROJECT_SUMMARY.md                # Complete project overview
â”‚   â”œâ”€â”€ DEPLOYMENT.md                     # Deployment guide & troubleshooting
â”‚   â””â”€â”€ docs/
â”‚       â”œâ”€â”€ ARCHITECTURE.md               # System architecture & design
â”‚       â””â”€â”€ INTEGRATION_GUIDE.md          # Integration examples
â”‚
â”œâ”€â”€ ğŸ”§ Source Code
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ index.js                      # HTTP API server (main entry)
â”‚       â”œâ”€â”€ config.js                     # Configuration & constants
â”‚       â”œâ”€â”€ ingestion-service.js          # Main orchestrator
â”‚       â”‚
â”‚       â”œâ”€â”€ utils/
â”‚       â”‚   â””â”€â”€ url-detector.js           # YouTube URL pattern matching
â”‚       â”‚
â”‚       â”œâ”€â”€ extractors/
â”‚       â”‚   â”œâ”€â”€ transcript-extractor.js   # Transcript extraction w/ retry
â”‚       â”‚   â””â”€â”€ metadata-extractor.js     # Metadata scraping (title, etc.)
â”‚       â”‚
â”‚       â”œâ”€â”€ processors/
â”‚       â”‚   â””â”€â”€ classifier.js             # AI classification (Claude)
â”‚       â”‚
â”‚       â”œâ”€â”€ storage/
â”‚       â”‚   â””â”€â”€ knowledge-store.js        # Redis + Filesystem storage
â”‚       â”‚
â”‚       â”œâ”€â”€ agents/
â”‚       â”‚   â””â”€â”€ improvement-agent.js      # Self-improvement & meta-review
â”‚       â”‚
â”‚       â””â”€â”€ middleware/
â”‚           â””â”€â”€ message-interceptor.js    # Cortex Chat integration hook
â”‚
â”œâ”€â”€ â˜¸ï¸  Kubernetes Manifests
â”‚   â””â”€â”€ k8s/
â”‚       â”œâ”€â”€ deployment.yaml               # Main deployment (1 replica)
â”‚       â”œâ”€â”€ service.yaml                  # ClusterIP service
â”‚       â”œâ”€â”€ pvc.yaml                      # 10Gi persistent volume claim
â”‚       â””â”€â”€ ingress.yaml                  # Optional external access
â”‚
â”œâ”€â”€ ğŸš€ Deployment Scripts
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ build-and-deploy.sh           # Automated build & deploy
â”‚       â””â”€â”€ test-service.sh               # Comprehensive test suite
â”‚
â”œâ”€â”€ ğŸ“š Examples
â”‚   â””â”€â”€ examples/
â”‚       â””â”€â”€ example-usage.js              # Complete usage examples
â”‚
â”œâ”€â”€ ğŸ³ Container
â”‚   â”œâ”€â”€ Dockerfile                        # Multi-stage Node.js build
â”‚   â””â”€â”€ package.json                      # Dependencies & scripts
â”‚
â””â”€â”€ ğŸ“Š Data Directories (Runtime)
    â””â”€â”€ /data/                            # Created in container
        â”œâ”€â”€ transcripts/                  # Raw transcripts
        â”œâ”€â”€ knowledge/                    # Processed knowledge (JSON)
        â””â”€â”€ cache/                        # Temporary data


Key Features by Component
==========================

ğŸ” URL Detector
  â€¢ Multi-format YouTube URL detection
  â€¢ Regex pattern matching
  â€¢ Video ID extraction

ğŸ“ Transcript Extractor
  â€¢ youtube-transcript npm library
  â€¢ Multi-language support (prefers English)
  â€¢ Retry logic with exponential backoff
  â€¢ Timestamp preservation

ğŸ¤– AI Classifier (Claude Sonnet 4.5)
  â€¢ Content categorization (10 categories)
  â€¢ Relevance scoring (0.0-1.0)
  â€¢ Key concept extraction
  â€¢ Actionable item identification
  â€¢ Tool/technology detection

ğŸ’¾ Knowledge Store (Dual Layer)
  Redis Layer:
    â€¢ Fast access & indexing
    â€¢ Category/relevance indexes
    â€¢ TTL-based expiration (30 days)
  Filesystem Layer:
    â€¢ Persistent backup
    â€¢ Full JSON documents
    â€¢ Fallback when Redis unavailable

ğŸ§  Improvement Agent
  Passive (Auto):
    â€¢ Add knowledge to context
    â€¢ Update pattern library
    â€¢ Enhance understanding
  Active (Approval):
    â€¢ Suggest new integrations
    â€¢ Propose architecture changes
    â€¢ Recommend prompt updates

ğŸ”¬ Meta-Review Agent
  â€¢ Analyze patterns across videos
  â€¢ Identify recurring themes/tools
  â€¢ Generate strategic insights (Claude)
  â€¢ Prioritize recommendations


API Endpoints
=============

Core:
  GET  /health              â†’ Health check
  GET  /stats               â†’ Knowledge base stats
  POST /process             â†’ Auto-detect URLs in message
  POST /ingest              â†’ Manually ingest video

Query:
  GET  /videos?limit=N      â†’ List all videos
  GET  /video/:videoId      â†’ Get specific video
  POST /search              â†’ Search knowledge base

Improvement:
  GET  /improvements        â†’ Get pending proposals
  POST /meta-review         â†’ Perform meta-review


Integration Points
==================

1. Cortex Chat Backend
   Import: src/middleware/message-interceptor.js
   Hook: In message handler
   Purpose: Auto-detect YouTube URLs

2. Claude Code CLI
   Commands: /ingest, /learned, /improve
   Purpose: Manual ingestion & queries

3. MCP Server
   Tools: youtube_ingest, youtube_search
   Purpose: Programmatic access


Deployment Workflow
===================

1. Prerequisites
   âœ“ k3s cluster running
   âœ“ Redis at redis-queue.cortex.svc.cluster.local
   âœ“ Anthropic API key in secret
   âœ“ Local registry at localhost:5000

2. Deploy
   $ cd /path/to/youtube-ingestion
   $ ./scripts/build-and-deploy.sh

3. Verify
   $ kubectl get pods -n cortex -l app=youtube-ingestion
   $ kubectl logs -n cortex -l app=youtube-ingestion

4. Test
   $ kubectl port-forward -n cortex svc/youtube-ingestion 8080:8080
   $ ./scripts/test-service.sh


Technology Stack
================

Runtime:       Node.js 20 (Alpine)
Transport:     HTTP/JSON REST API
AI:            Claude Sonnet 4.5 (Anthropic)
Storage:       Redis + Filesystem
Orchestration: Kubernetes (k3s)
Container:     Docker


Resource Requirements
=====================

Deployment:
  Replicas:  1 (can scale with queue-based processing)
  CPU:       200m request, 1000m limit
  Memory:    256Mi request, 1Gi limit
  Storage:   10Gi PVC (local-path)

Network:
  Service:   ClusterIP (internal only)
  Port:      8080
  DNS:       youtube-ingestion.cortex.svc.cluster.local


Monitoring
==========

Health:
  Liveness:  /health every 10s
  Readiness: /health every 5s

Metrics:
  Total videos ingested
  Videos by category
  Average relevance score
  Recent count (7 days)

Logs:
  Structured with component prefixes
  [URLDetector], [TranscriptExtractor], etc.
  Error stack traces included


Files Summary
=============

Source Code:         13 files
Documentation:        5 files
Kubernetes:           4 files
Scripts:              2 files
Examples:             1 file
Configuration:        2 files
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:               27 files


Lines of Code (Estimated)
==========================

Source JavaScript:  ~2,500 lines
Documentation:      ~2,000 lines
Configuration:        ~200 lines
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total:              ~4,700 lines


Status: âœ… COMPLETE - Ready for Production
Built by: Larry (Backend Infrastructure Specialist)
Date: 2025-12-28
